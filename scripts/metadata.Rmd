---
title: "metadata_report"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(stringr)
library(dplyr)
```




# Creating metadata table for maternal lung samples

```{r}
ml_metadata <- 
  here("/data/metadata/ml_metadata.csv") %>% 
  read_delim(., col_names = TRUE, delim = ";") 
ml_metadata

mli_metadata <- 
  here("/data/metadata/mli_metadata.csv") %>% 
  read_delim(., col_names = TRUE, delim = ";") 
mli_metadata

fli_metadata <- 
  here("/data/metadata/fli_metadata.csv") %>% 
  read_delim(., col_names = TRUE, delim = ";") 
fli_metadata

fp_metadata <- 
  here("/data/metadata/fp_metadata.csv") %>% 
  read_delim(., col_names = TRUE, delim = ";") 
fp_metadata

mp_metadata <- 
  here("/data/metadata/mp_metadata.csv") %>% 
  read_delim(., col_names = TRUE, delim = ";") 
mp_metadata


```

#Using Rbind to combine the different metadata data-frame/vectors by columns.
```{r}
sample_metadata <- rbind(fp_metadata, mp_metadata, mli_metadata, fli_metadata, ml_metadata, deparse.level = 1, make.row.names = TRUE, stringsAsFactors = default.stringsAsFactors())
sample_metadata
```

# Joining/merging the five tissue-specific metadata tables

```{r}
nest_join(sample_metadata, by = NULL, copy = FALSE, merge(incomparables = FALSE))
```


# Make two new columns with animal_no and sample_id

```{r}
ml_metadata1 <- transmute(ml_metadata, 
                          animal_no = str_extract(string = Animal_no, pattern = "[0-9]{1,}"),
                          
                          sample_id = Animal_no,
                          
                          tissue = str_extract(string = sample_id, pattern = "^[:alpha:]{2,3}") %>%
                          factor(x=., levels = c("ML","MP","FP","MLi","FLi"), labels =
                                   c("lung","placenta","placenta","liver", "liver")),
                          
                          maternal_fetal = str_extract(string = sample_id, pattern = "^[M,F]") %>% 
                            factor(x = ., levels = c("M","F"), labels = c("maternal","fetal")),
                          
                          exposure = Exposure %>% 
                            factor(x = ., levels = c("nanopurevand","nanopure","Control","ctr","Ctr","LPS","TiO2"), labels =
                                      c("ctr","ctr","ctr","ctr","ctr","LPS","TiO2"))) 

ml_metadata1
                                   
                                   


```


 
```{r}
#abcd <- c(1,2,3,4,4)
factor(x = ml_metadata, levels = c(1, 3, 2, 4), labels = c("a","b","c","d"))
```



```{r}
factor(x = ML$Animal_no, labels = 1:86)
```


#Animal metadata
# Reading in the metadata file

```{r}
metadata <- read_csv(here("data/metadata/sample_metadata_table.csv"))
metadata
```

# Weightloss between instillation and death depending on treatment

```{r}
metadata %>%
  mutate(., 
         Weight_ratio = Weight_death / Weight_instillation,
         time_group = paste(time_point, Particle, sep = "_")
         ) %>% 
ggplot(aes(x = time_point, y = Weight_ratio, col = Particle, group = time_group)) +
  theme_bw() + 
  geom_boxplot() +
  geom_point() +
  ggtitle("weightloss depends on particle exposure")
```
#No of animals having received LPS
```{r}
metadata %>%
str_count("Particle",LPS)
```


# Reading in the genotyping and RIN scores of the maternal placentas
```{r}
MP <- read_csv2(here("data/metadata/sample_MP_RNA_table_KU.csv"))

head(MP)

View(MP)

#test
```

#No of MP samples
```{r}
unique(MP$Animal_ID) %>% 
  length(.)
```


# No of pups visually determined to be female but genotyped to be male
```{r}
str_extract(string = MP$No_female, pattern = "F[^1]|M.") 
table(MP$No_female, useNA = "always")
```

